{
    "scenarioName": "Produce a JSON via REST Proxy and consume a AVRO msg message as JSON",
    "steps": [
        {
            "name": "produce_avro_raw",
            "url": "kafka-topic:za.vitality.rewardscalculator.import.member.info.lookup.request",
            "operation": "PRODUCE",
            "request": {
                "recordType" : "JSON",
                "headers": {
                    "Content-Type": "application/vnd.kafka.avro.v1+json",
                    "Accept": "application/vnd.kafka.v1+json, application/vnd.kafka+json, application/json"
                },
                "body": {
                    "value_schema": "[\n  {\n    \"type\": \"record\",\n    \"name\": \"RewardsCalculatorPurchasedArticles\",\n    \"namespace\": \"avro.vitality.rewardscalculator.vitalitysharedcommons\",\n    \"fields\": [\n      {\n        \"name\": \"articleId\",\n        \"type\": \"long\",\n        \"doc\": \"The unique identifier of the article at the partner.\"\n      },\n      {\n        \"name\": \"articleBarcode\",\n        \"type\": \"string\",\n        \"doc\": \"Unique identifier of the article.\"\n      },\n      {\n        \"name\": \"articleName\",\n        \"type\": \"string\",\n        \"doc\": \"Description of the Item\"\n      },\n      {\n        \"name\": \"primaryArticlePrice\",\n        \"type\": \"double\"\n      },\n      {\n        \"name\": \"secondaryArticlePrice\",\n        \"type\": [\n          \"null\",\n          \"double\"\n        ],\n        \"default\": null\n      },\n      {\n        \"name\": \"quantity\",\n        \"type\": \"double\",\n        \"doc\": \"How many items were purchased.\"\n      },\n      {\n        \"name\": \"bmc\",\n        \"doc\": \"Contains any additional attributes required.\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"default\": null\n      },\n      {\n        \"name\": \"articleQualifyingIndicator\",\n        \"type\": \"int\",\n        \"default\": 0\n      },\n      {\n        \"name\": \"rewardIndicator\",\n        \"type\": [\n          \"null\",\n          \"long\"\n        ],\n        \"default\": null,\n        \"doc\": \"TODO: This field might not be required.\"\n      },\n      {\n        \"name\": \"supplierId\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"default\": null,\n        \"doc\": \"Supplier’s brand.\\nTODO: Confirm if field is required.\"\n      },\n      {\n        \"name\": \"articleCategory\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"default\": null,\n        \"doc\": \"The category that classifies the article.\"\n      },\n      {\n        \"name\": \"reportCategory\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"default\": null,\n        \"doc\": \"The category that classifies the article.\\nTODO: Confirm if field is required.\"\n      },\n      {\n        \"name\": \"foodIndicator\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"default\": null,\n        \"doc\": \"Indicates food or non-food item\"\n      },\n      {\n        \"name\": \"externalArticleAmount\",\n        \"type\": [\n          \"null\",\n          \"double\"\n        ],\n        \"default\": null,\n        \"doc\": \"Additional amount field used for reporting or for classification or exclusion from reward.\\nTODO: Confirm if field is required.\"\n      },\n      {\n        \"name\": \"externalArticleCategory\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"default\": null,\n        \"doc\": \"Describes the External Article Amount.\\nTODO: Confirm if field is required.\"\n      },\n      {\n        \"name\": \"articleDiscountAmount\",\n        \"type\": [\n          \"null\",\n          \"double\"\n        ],\n        \"default\": null,\n        \"doc\": \"The reward applied to the article discount amount applied to the item as per the ArticleDiscountPercentage. This could differ per item.\"\n      },\n      {\n        \"name\": \"articleDiscountPercentage\",\n        \"type\": [\n          \"null\",\n          \"double\"\n        ],\n        \"default\": null,\n        \"doc\": \"The reward % applied to the item. This could differ per item. This should be displayed at the decimal value.  E.g. 0.15, 0.20 etc.\"\n      },\n      {\n        \"name\": \"limitReachedIndicator\",\n        \"type\": [\n          \"null\",\n          \"int\"\n        ],\n        \"default\": null,\n        \"doc\": \"Indicates whether the member’s cap on rewards has been reached. 0=not reached 1=reached.\\nThis is also referred to as Capitation Reached Indicator\"\n      }\n    ]\n  },\n  {\n    \"type\": \"record\",\n    \"name\": \"RewardsCalculatorPurchasedTransaction\",\n    \"namespace\": \"avro.vitality.rewardscalculator.vitalitysharedcommons\",\n    \"fields\": [\n      {\n        \"name\": \"transactionId\",\n        \"doc\": \"Unique identifier of the transaction at the partner.\\nIn the database this column is called MEMBER_STATEMENT_ID\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"default\": null\n      },\n      {\n        \"name\": \"memberEntityNumber\",\n        \"type\": [\n          \"null\",\n          \"long\"\n        ],\n        \"default\": null,\n        \"doc\": \"It's the entityNumber of the member.\"\n      },\n      {\n        \"name\": \"requestIdentifier\",\n        \"type\": \"string\",\n        \"doc\": \"For Dischem this is the unique Request number i.e. 2324000. And for Clicks it is generated based on fileIdentifier,fileDate,fileSequenceNumber\"\n      },\n      {\n        \"name\": \"transactionDate\",\n        \"type\": {\n          \"type\": \"long\",\n          \"logicalType\": \"local-timestamp-millis\"\n        },\n        \"doc\": \"Date that the transaction was made at the partner.\"\n      },\n      {\n        \"name\": \"transactionPostingDate\",\n        \"type\": [\n          \"null\",\n          {\n            \"type\": \"long\",\n            \"logicalType\": \"local-timestamp-millis\"\n          }\n        ],\n        \"doc\": \"Date that the transaction was sent to Vitality.\",\n        \"default\": null\n      },\n      {\n        \"name\": \"accountNumber\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"doc\": \"Partner member info.\\nTODO: Confirm if this field is required\",\n        \"default\": null\n      },\n      {\n        \"name\": \"primaryLoyaltyCardNumber\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"doc\": \"Partner member info. This is the unique identifier used by the member at the partner.\\nOnly optional if entity number is supplied\",\n        \"default\": null\n      },\n      {\n        \"name\": \"secondaryLoyaltyCardNumber\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"doc\": \"Partner member info. This is to identify additional loyalty cards used in the transactions.\",\n        \"default\": null\n      },\n      {\n        \"name\": \"externalMembershipNumber\",\n        \"type\": [\n          \"null\",\n          \"long\"\n        ],\n        \"doc\": \"Membership number used at the partner.\",\n        \"default\": null\n      },\n      {\n        \"name\": \"partnerFileId\",\n        \"type\": [\n          \"null\",\n          \"long\"\n        ],\n        \"doc\": \"Populated from table RC_FILE_IMPORT_STAGE table using sequence VIT_RC.REWARDS_CALC_SEQ\",\n        \"default\": null\n      },\n      {\n        \"name\": \"transactionCategory\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"doc\": \"Defines the category of transaction.\",\n        \"default\": null\n      },\n      {\n        \"name\": \"transactionDescription\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"doc\": \"Description of the transaction.\",\n        \"default\": null\n      },\n      {\n        \"name\": \"transactionSource\",\n        \"type\": \"string\",\n        \"doc\": \"B for batch (currently used by Clicks), S for service (currently used by Dischem) and M for manual.\"\n      },\n      {\n        \"name\": \"partnerEntityNumber\",\n        \"type\": \"long\",\n        \"doc\": \"Unique number of merchant.\\nIn the database this column is called MERCHANT_NO\"\n      },\n      {\n        \"name\": \"merchantTransactionId\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"doc\": \"Defines the unique reference for the transaction made.\\nCurrently used for DISCHEM only, it is a combination of merchantBranchCode and merchantBranchName\",\n        \"default\": null\n      },\n      {\n        \"name\": \"merchantBranchCode\",\n        \"type\": [\n          \"null\",\n          \"long\"\n        ],\n        \"default\": null\n      },\n      {\n        \"name\": \"merchantBranchName\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"doc\": \"Defines where the purchase was made.\",\n        \"default\": null\n      },\n      {\n        \"name\": \"merchantPciIdentifier\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"doc\": \"PCI number from the bank for credit card transactions. \",\n        \"default\": null\n      },\n      {\n        \"name\": \"merchantSicCode\",\n        \"type\": [\n          \"null\",\n          \"long\"\n        ],\n        \"doc\": \"TODO: Confirm if field is required.\",\n        \"default\": null\n      },\n      {\n        \"name\": \"storePnNumber\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"doc\": \"TODO: Confirm if field is required.\",\n        \"default\": null\n      },\n      {\n        \"name\": \"foreignDomesticCode\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"doc\": \"TODO: Confirm if field is required. Could also be referred to as ForeignDomesticInd\",\n        \"default\": null\n      },\n      {\n        \"name\": \"externalSpendReference\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"doc\": \"Original transaction id/reference on the partner side.\",\n        \"default\": null\n      },\n      {\n        \"name\": \"transactionQualifyingIndicator\",\n        \"type\": \"int\",\n        \"doc\": \"Either 0 or 1\",\n        \"default\": 0\n      },\n      {\n        \"name\": \"primaryPayMethod\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"doc\": \"Defines the type of transaction: Credit card transaction vs other transaction types, e.g B for Discovery Bank\",\n        \"default\": null\n      },\n      {\n        \"name\": \"transactionAmount\",\n        \"type\": \"double\",\n        \"doc\": \"This is the amount before any Reward Program discounts were applied.\\nFor Clicks this is the total of the Primary Article Price based on the 003 lines linked to this transaction\"\n      },\n      {\n        \"name\": \"primaryPurchaseAmount\",\n        \"type\": \"double\",\n        \"doc\": \"Defines the amount spent on the transaction by the member.\\nFor Clicks this is the total of the Secondary Article Price based on the 003 lines linked to this transaction\"\n      },\n      {\n        \"name\": \"secondaryPurchaseAmount\",\n        \"type\": [\n          \"null\",\n          \"double\"\n        ],\n        \"doc\": \"\\nTODO: Confirm if field is required. Is this CLICKS/DISCHEM specific\",\n        \"default\": null\n      },\n      {\n        \"name\": \"primaryCardAmount\",\n        \"type\": [\n          \"null\",\n          \"double\"\n        ],\n        \"doc\": \"Total Transaction Amount that was tendered for by using the Primary Loyalty Card as payment method\",\n        \"default\": null\n      },\n      {\n        \"name\": \"secondaryCardAmount\",\n        \"type\": [\n          \"null\",\n          \"double\"\n        ],\n        \"doc\": \"Amount paid towards the Total Transaction Amount by using the Secondary Loyalty Card as payment method\",\n        \"default\": null\n      },\n      {\n        \"name\": \"qualifyingAmount\",\n        \"type\": \"double\",\n        \"doc\": \"Total transaction amount that qualifies for the reward program\",\n        \"default\": 0.0\n      },\n      {\n        \"name\": \"excludedAmount\",\n        \"type\": \"double\",\n        \"doc\": \"The total amount that specifically should not be taken into account for calculating rewards.\",\n        \"default\": 0.0\n      },\n      {\n        \"name\": \"articlesPurchased\",\n        \"type\": {\n          \"type\": \"array\",\n          \"items\": \"avro.vitality.rewardscalculator.vitalitysharedcommons.RewardsCalculatorPurchasedArticles\"\n        },\n        \"doc\": \"List of articles purchased at partner\",\n        \"default\": []\n      },\n      {\n        \"name\": \"transactionAuthCode\",\n        \"type\": [\n          \"null\",\n          \"string\"\n        ],\n        \"doc\": \"Used for device payments e.g. Apple Pay, Samsung Pay, Google Pay etc, to identify Discovery Bank members\",\n        \"default\": null\n      }\n    ]\n  },\n  {\n    \"namespace\": \"avro.vitality.rewardscalculator.vitalitysharedcommons\",\n    \"type\": \"record\",\n    \"name\": \"RewardsCalculatorMemberInfo\",\n    \"fields\": [\n      { \"name\": \"data\",\"type\": {\"type\": \"map\", \"values\": \"string\"}}\n    ]\n  },\n  {\n    \"type\": \"record\",\n    \"name\": \"RewardsCalculatorBenefitInfo\",\n    \"namespace\": \"avro.vitality.rewardscalculator.vitalitysharedcommons\",\n    \"fields\": [\n      {\n        \"name\": \"benefitIdentifier\",\n        \"type\":\"string\",\n        \"doc\": \"The identifier of the benefit. e.g. HealthyCare, HealthyFood, HealthyDining\"\n      },\n      {\n        \"name\": \"partnerName\",\n        \"type\": \"string\",\n        \"doc\": \"The name of the partner for the benefit. e.g. Clicks, Dischem\"\n      },\n      {\n        \"name\": \"partnerEntityNumber\",\n        \"type\":\"long\",\n        \"doc\": \"The entity number of the partner as it appears on the ENTITIES table.\"\n      },\n      {\n        \"name\": \"benefitActive\",\n        \"type\": \"boolean\",\n        \"doc\": \"Boolean indicating whether the benefit is active or not at the current partner.\"\n      },\n      {\n        \"name\": \"benefitEligible\",\n        \"type\": \"boolean\",\n        \"doc\": \"Boolean indicating whether the benefit is eligible or not.\"\n      },\n      {\n        \"name\": \"preferredPartner\",\n        \"type\":  \"boolean\",\n        \"doc\": \"Boolean indicating whether the the current partner is the preferred partner\"\n      }\n    ]\n  },\n  {\n    \"type\": \"record\",\n    \"name\": \"RewardsCalculatorContext\",\n    \"namespace\": \"avro.vitality.rewardscalculator.vitalitysharedcommons\",\n    \"fields\": [\n      {\n        \"name\": \"rewardsCalculatorPurchasedTransaction\",\n        \"type\": \"avro.vitality.rewardscalculator.vitalitysharedcommons.RewardsCalculatorPurchasedTransaction\"\n      },\n      {\n        \"name\": \"rewardsCalculatorMemberInfo\",\n        \"type\": {\n          \"type\": \"map\",\n          \"values\": [\n            \"null\",\n            \"avro.vitality.rewardscalculator.vitalitysharedcommons.RewardsCalculatorMemberInfo\"\n          ]\n        },\n        \"default\": {}\n      },\n      {\n        \"name\": \"rewardsCalculatorBenefitInfo\",\n        \"type\": {\n          \"type\": \"array\",\n          \"items\": \"avro.vitality.rewardscalculator.vitalitysharedcommons.RewardsCalculatorBenefitInfo\"\n        },\n        \"doc\": \"Benefit details for the entity at the current partner.\",\n        \"default\": []\n      },\n      {\n        \"name\": \"contextMetaData\",\n        \"type\": {\n          \"type\": \"map\",\n          \"values\": [\n            \"null\",\n            \"string\"\n          ]\n        },\n        \"default\": {}\n      }\n    ]\n  }\n]",
                    "records": [
                        {
                            "key": "justin-test01",
                            "value": "{\n  \"rewardsCalculatorPurchasedTransaction\": {\n    \"transactionId\": \"2275554277\",\n    \"memberEntityNumber\": 1601848193,\n    \"requestIdentifier\": \"HEALTHYCARE-2022-04-04-11\",\n    \"transactionDate\": \"2016-05-28T17:39:44.937\",\n    \"transactionPostingDate\": \"2016-05-28T17:39:44.937\",\n    \"accountNumber\": \"\",\n    \"primaryLoyaltyCardNumber\": \"0200431317405\",\n    \"secondaryLoyaltyCardNumber\": \"\",\n    \"externalMembershipNumber\": null,\n    \"partnerFileId\": 1196,\n    \"transactionCategory\": null,\n    \"transactionDescription\": null,\n    \"transactionSource\": \"B\",\n    \"partnerEntityNumber\": 1121032898,\n    \"merchantTransactionId\": null,\n    \"merchantBranchCode\": 101,\n    \"merchantBranchName\": \"TABLEVIEW Cape (CPT)-CLICKS\",\n    \"merchantPciIdentifier\": \"\",\n    \"merchantSicCode\": null,\n    \"storePnNumber\": null,\n    \"foreignDomesticCode\": null,\n    \"externalSpendReference\": \"\",\n    \"transactionQualifyingIndicator\": \"33\",\n    \"primaryPayMethod\": \"\",\n    \"transactionAmount\": 400,\n    \"primaryPurchaseAmount\": 400,\n    \"secondaryPurchaseAmount\": null,\n    \"primaryCardAmount\": null,\n    \"secondaryCardAmount\": null,\n    \"qualifyingAmount\": 400,\n    \"excludedAmount\": 0,\n    \"articlesPurchased\": [\n      {\n        \"articleId\": 192726,\n        \"articleBarcode\": \"6009661219039\",\n        \"articleName\": \"NIVEA KIDS CARING SPF50 PLUS SPRAY 300ML VIT\",\n        \"primaryArticlePrice\": 200,\n        \"secondaryArticlePrice\": null,\n        \"quantity\": 1,\n        \"bmc\": \"\",\n        \"articleQualifyingIndicator\": 0,\n        \"rewardIndicator\": 1,\n        \"supplierId\": \"BEIERSDORF CONSUMER (DC AC)\",\n        \"articleCategory\": \"\",\n        \"reportCategory\": \"\",\n        \"foodIndicator\": \"\",\n        \"externalArticleAmount\": null,\n        \"externalArticleCategory\": \"\",\n        \"articleDiscountAmount\": null,\n        \"articleDiscountPercentage\": null,\n        \"limitReachedIndicator\": null\n      },\n      {\n        \"articleId\": 217098,\n        \"articleBarcode\": \"6001051001903\",\n        \"articleName\": \"NIVEA SUN MOISTURISING SPRAY SPF50PLUS 300ML VIT\",\n        \"primaryArticlePrice\": 200,\n        \"secondaryArticlePrice\": null,\n        \"quantity\": 1,\n        \"bmc\": \"\",\n        \"articleQualifyingIndicator\": 0,\n        \"rewardIndicator\": 1,\n        \"supplierId\": \"BEIERSDORF CONSUMER (DC AC)\",\n        \"articleCategory\": \"\",\n        \"reportCategory\": \"\",\n        \"foodIndicator\": \"\",\n        \"externalArticleAmount\": null,\n        \"externalArticleCategory\": \"\",\n        \"articleDiscountAmount\": null,\n        \"articleDiscountPercentage\": null,\n        \"limitReachedIndicator\": null\n      }\n    ],\n    \"transactionAuthCode\": null\n  },\n  \"rewardsCalculatorMemberInfo\": {},\n  \"rewardsCalculatorBenefitInfo\": [\n    {\n      \"benefitIdentifier\": \"HealthyCare\",\n      \"partnerName\": \"Clicks\",\n      \"partnerEntityNumber\": 1121032898,\n      \"benefitActive\": true,\n      \"benefitEligible\": false,\n      \"preferredPartner\": true\n    },\n    {\n      \"benefitIdentifier\": \"HealthyCare\",\n      \"partnerName\": \"Dischem\",\n      \"partnerEntityNumber\": 1121032963,\n      \"benefitActive\": true,\n      \"benefitEligible\": false,\n      \"preferredPartner\": false\n    }\n  ],\n  \"contextMetaData\": {\n    \"loyaltyCardType\": \"9\",\n    \"policyNumber\": \"5006821225\"\n  }\n}"
                        }

                    ]
                }
            },
            "assertions": {
                "status": "Ok"
            }
        }
    ]
}
